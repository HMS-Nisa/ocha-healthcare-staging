---
// src/pages/doctors.astro
import LandingLayout from '../layouts/LandingLayout.astro'; // ðŸ‘ˆ Switched to LandingLayout (Has Navbar/Footer)
import Directory from '../components/Directory.jsx';
import { GOOGLE_SHEET_URL } from '../config';

// ðŸš€ FETCH DATA AT BUILD TIME (SERVER-SIDE)
let allDoctors = [];
try {
  const noCacheUrl = `${GOOGLE_SHEET_URL}?t=${Date.now()}`;
  const response = await fetch(noCacheUrl);
  allDoctors = await response.json();
  console.log(`âœ… Fetched ${allDoctors.length} doctors at ${new Date().toLocaleTimeString()}`);
} catch (error) {
  console.error("Build-time fetch failed:", error);
}
---

<LandingLayout 
  title="Find a Specialist | Ocha Healthcare" 
  description="Browse our complete list of verified specialists in Malaysia. Filter by location, hospital, and specialty."
>
  
  {/* Background Texture */}
  <div class="absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20 pointer-events-none z-0"></div>

  {/* ðŸš€ FIXED: Added 'overflow-x-hidden' to kill the white gap on the right */}
  <main class="relative min-h-screen pt-32 pb-20 overflow-x-hidden">
    
    {/* === PAGE HEADER === */}
    <div class="max-w-4xl mx-auto px-6 text-center mb-12 relative z-10">
        <span class="inline-block py-1 px-3 rounded-full bg-blue-50 border border-blue-100 text-[#276CA1] text-xs font-bold uppercase tracking-wider mb-6">
          Directory
        </span>
        <h1 class="font-serif text-4xl md:text-5xl text-slate-900 mb-6 leading-tight">
          Find a Verified Specialist
        </h1>
        <p class="text-lg text-slate-500 max-w-2xl mx-auto leading-relaxed">
          Search our network of experienced doctors across Malaysia's top hospitals. 
          Filter by specialty, location, or name to find the right care.
        </p>
    </div>

    {/* === DIRECTORY COMPONENT === */}
    <section id="directory" class="max-w-7xl mx-auto px-4 sm:px-6 relative z-10">
        <Directory client:load preloadedDoctors={allDoctors} />
    </section>

  </main>
</LandingLayout>