---
// src/pages/doctors.astro
import Layout from '../layouts/Layout.astro';
import Directory from '../components/Directory.jsx';
import { GOOGLE_SHEET_URL } from '../config';

// ðŸš€ FETCH DATA AT BUILD TIME (SERVER-SIDE)
// We add '?t=timestamp' to trick the server into thinking it's a new request.
// This forces a fresh download of your Google Sheet data.
let allDoctors = [];
try {
  const noCacheUrl = `${GOOGLE_SHEET_URL}?t=${Date.now()}`;
  const response = await fetch(noCacheUrl);
  allDoctors = await response.json();
  
  // You will see this message in your VS Code / StackBlitz terminal
  console.log(`âœ… Fetched ${allDoctors.length} doctors at ${new Date().toLocaleTimeString()}`);
} catch (error) {
  console.error("Build-time fetch failed:", error);
}
---

<Layout title="Find a Specialist | Ocha Healthcare" description="Browse our complete list of verified specialists in Malaysia. Filter by location, hospital, and specialty.">
  
  {/* Background Texture */}
  <div class="absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20 pointer-events-none z-0"></div>

  <main class="relative min-h-screen pt-32 pb-20">
    
    {/* === PAGE HEADER === */}
    <div class="max-w-4xl mx-auto px-6 text-center mb-12 relative z-10">
        <span class="inline-block py-1 px-3 rounded-full bg-blue-50 border border-blue-100 text-[#276CA1] text-xs font-bold uppercase tracking-wider mb-6">
          Directory
        </span>
        <h1 class="font-serif text-4xl md:text-5xl text-slate-900 mb-6">
          Find a Verified Specialist
        </h1>
        <p class="text-lg text-slate-500 max-w-2xl mx-auto leading-relaxed">
          Search our network of experienced doctors across Malaysia's top hospitals. 
          Filter by specialty, location, or name to find the right care.
        </p>
    </div>

    {/* === DIRECTORY COMPONENT === */}
    {/* We pass the fresh 'allDoctors' data here so it loads instantly */}
    <section id="directory" class="max-w-7xl mx-auto px-4 sm:px-6 relative z-10">
        <Directory client:load preloadedDoctors={allDoctors} />
    </section>

  </main>
</Layout>